"use strict";
var __cov_075HeH56i5fNv8ZxFDWa0A = (Function('return this'))();
if (!__cov_075HeH56i5fNv8ZxFDWa0A.__coverage__) { __cov_075HeH56i5fNv8ZxFDWa0A.__coverage__ = {}; }
__cov_075HeH56i5fNv8ZxFDWa0A = __cov_075HeH56i5fNv8ZxFDWa0A.__coverage__;
if (!(__cov_075HeH56i5fNv8ZxFDWa0A['app/config/stripe-events.js'])) {
   __cov_075HeH56i5fNv8ZxFDWa0A['app/config/stripe-events.js'] = {"path":"app/config/stripe-events.js","s":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0},"b":{"1":[0,0],"2":[0,0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0},"fnMap":{"1":{"name":"(anonymous_1)","line":58,"loc":{"start":{"line":58,"column":34},"end":{"line":58,"column":54}}},"2":{"name":"(anonymous_2)","line":64,"loc":{"start":{"line":64,"column":47},"end":{"line":64,"column":73}}},"3":{"name":"(anonymous_3)","line":70,"loc":{"start":{"line":70,"column":15},"end":{"line":70,"column":36}}},"4":{"name":"(anonymous_4)","line":87,"loc":{"start":{"line":87,"column":28},"end":{"line":87,"column":43}}},"5":{"name":"(anonymous_5)","line":101,"loc":{"start":{"line":101,"column":17},"end":{"line":101,"column":43}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":4,"column":42}},"2":{"start":{"line":5,"column":0},"end":{"line":7,"column":21}},"3":{"start":{"line":9,"column":0},"end":{"line":55,"column":2}},"4":{"start":{"line":57,"column":0},"end":{"line":62,"column":1}},"5":{"start":{"line":58,"column":5},"end":{"line":61,"column":6}},"6":{"start":{"line":59,"column":10},"end":{"line":59,"column":66}},"7":{"start":{"line":60,"column":10},"end":{"line":60,"column":32}},"8":{"start":{"line":64,"column":0},"end":{"line":99,"column":1}},"9":{"start":{"line":65,"column":5},"end":{"line":98,"column":6}},"10":{"start":{"line":67,"column":10},"end":{"line":95,"column":18}},"11":{"start":{"line":71,"column":20},"end":{"line":73,"column":21}},"12":{"start":{"line":72,"column":25},"end":{"line":72,"column":42}},"13":{"start":{"line":74,"column":20},"end":{"line":94,"column":21}},"14":{"start":{"line":76,"column":25},"end":{"line":76,"column":54}},"15":{"start":{"line":79,"column":25},"end":{"line":93,"column":28}},"16":{"start":{"line":88,"column":30},"end":{"line":90,"column":31}},"17":{"start":{"line":89,"column":35},"end":{"line":89,"column":52}},"18":{"start":{"line":91,"column":30},"end":{"line":91,"column":111}},"19":{"start":{"line":92,"column":30},"end":{"line":92,"column":59}},"20":{"start":{"line":97,"column":10},"end":{"line":97,"column":82}},"21":{"start":{"line":101,"column":0},"end":{"line":107,"column":1}},"22":{"start":{"line":102,"column":5},"end":{"line":106,"column":6}},"23":{"start":{"line":103,"column":10},"end":{"line":103,"column":60}},"24":{"start":{"line":105,"column":10},"end":{"line":105,"column":59}}},"branchMap":{"1":{"line":65,"type":"if","locations":[{"start":{"line":65,"column":5},"end":{"line":65,"column":5}},{"start":{"line":65,"column":5},"end":{"line":65,"column":5}}]},"2":{"line":65,"type":"binary-expr","locations":[{"start":{"line":65,"column":9},"end":{"line":65,"column":29}},{"start":{"line":65,"column":33},"end":{"line":65,"column":60}},{"start":{"line":65,"column":64},"end":{"line":65,"column":100}}]},"3":{"line":71,"type":"if","locations":[{"start":{"line":71,"column":20},"end":{"line":71,"column":20}},{"start":{"line":71,"column":20},"end":{"line":71,"column":20}}]},"4":{"line":74,"type":"if","locations":[{"start":{"line":74,"column":20},"end":{"line":74,"column":20}},{"start":{"line":74,"column":20},"end":{"line":74,"column":20}}]},"5":{"line":88,"type":"if","locations":[{"start":{"line":88,"column":30},"end":{"line":88,"column":30}},{"start":{"line":88,"column":30},"end":{"line":88,"column":30}}]},"6":{"line":102,"type":"if","locations":[{"start":{"line":102,"column":5},"end":{"line":102,"column":5}},{"start":{"line":102,"column":5},"end":{"line":102,"column":5}}]},"7":{"line":102,"type":"binary-expr","locations":[{"start":{"line":102,"column":9},"end":{"line":102,"column":24}},{"start":{"line":102,"column":28},"end":{"line":102,"column":48}},{"start":{"line":102,"column":52},"end":{"line":102,"column":85}}]}}};
}
__cov_075HeH56i5fNv8ZxFDWa0A = __cov_075HeH56i5fNv8ZxFDWa0A['app/config/stripe-events.js'];
__cov_075HeH56i5fNv8ZxFDWa0A.s['1']++;var User=require('../models/user'),utils=require('../utils').findUser;__cov_075HeH56i5fNv8ZxFDWa0A.s['2']++;var findUser=utils.findUser,updateUser=utils.updateUser,knownEvents={};__cov_075HeH56i5fNv8ZxFDWa0A.s['3']++;var eventNames=['account.updated','account.application.deauthorized','application_fee.created','application_fee.refunded','balance.available','charge.succeeded','charge.failed','charge.refunded','charge.captured','charge.updated','charge.dispute.created','charge.dispute.updated','charge.dispute.closed','customer.created','customer.updated','customer.deleted','customer.card.created','customer.card.updated','customer.card.deleted','customer.subscription.created','customer.subscription.updated','customer.subscription.trial_will_end','customer.discount.created','customer.discount.updated','customer.discount.deleted','invoice.created','invoice.updated','invoice.payment_succeeded','invoice.payment_failed ','invoiceitem.created','invoiceitem.updated','invoiceitem.deleted','plan.created','plan.updated','plan.deleted','coupon.created','coupon.deleted','recipient.created','recipient.updated','recipient.deleted','transfer.created','transfer.updated','transfer.paid','transfer.failed','ping'];__cov_075HeH56i5fNv8ZxFDWa0A.s['4']++;for(var i=0,leng=eventNames.length;i<leng;i++){__cov_075HeH56i5fNv8ZxFDWa0A.s['5']++;knownEvents[eventNames[i]]=function(req,res){__cov_075HeH56i5fNv8ZxFDWa0A.f['1']++;__cov_075HeH56i5fNv8ZxFDWa0A.s['6']++;console.log(req.stripeEvent.type+': event processed');__cov_075HeH56i5fNv8ZxFDWa0A.s['7']++;res.status(200).end();};}__cov_075HeH56i5fNv8ZxFDWa0A.s['8']++;knownEvents['customer.subscription.deleted']=function(req,res,next){__cov_075HeH56i5fNv8ZxFDWa0A.f['2']++;__cov_075HeH56i5fNv8ZxFDWa0A.s['9']++;if((__cov_075HeH56i5fNv8ZxFDWa0A.b['2'][0]++,req.stripeEvent.data)&&(__cov_075HeH56i5fNv8ZxFDWa0A.b['2'][1]++,req.stripeEvent.data.object)&&(__cov_075HeH56i5fNv8ZxFDWa0A.b['2'][2]++,req.stripeEvent.data.object.customer)){__cov_075HeH56i5fNv8ZxFDWa0A.b['1'][0]++;__cov_075HeH56i5fNv8ZxFDWa0A.s['10']++;findUser({resetPasswordToken:req.params.token},function(err,user){__cov_075HeH56i5fNv8ZxFDWa0A.f['3']++;__cov_075HeH56i5fNv8ZxFDWa0A.s['11']++;if(err){__cov_075HeH56i5fNv8ZxFDWa0A.b['3'][0]++;__cov_075HeH56i5fNv8ZxFDWa0A.s['12']++;return next(err);}else{__cov_075HeH56i5fNv8ZxFDWa0A.b['3'][1]++;}__cov_075HeH56i5fNv8ZxFDWa0A.s['13']++;if(!user){__cov_075HeH56i5fNv8ZxFDWa0A.b['4'][0]++;__cov_075HeH56i5fNv8ZxFDWa0A.s['14']++;return res.status(200).end();}else{__cov_075HeH56i5fNv8ZxFDWa0A.b['4'][1]++;__cov_075HeH56i5fNv8ZxFDWa0A.s['15']++;updateUser({uid:req.user.id},{$PUT:{last4:'',plan:'free',subscriptionId:''}},function(err){__cov_075HeH56i5fNv8ZxFDWa0A.f['4']++;__cov_075HeH56i5fNv8ZxFDWa0A.s['16']++;if(err){__cov_075HeH56i5fNv8ZxFDWa0A.b['5'][0]++;__cov_075HeH56i5fNv8ZxFDWa0A.s['17']++;return next(err);}else{__cov_075HeH56i5fNv8ZxFDWa0A.b['5'][1]++;}__cov_075HeH56i5fNv8ZxFDWa0A.s['18']++;console.log('user: '+user.email+' subscription was successfully cancelled.');__cov_075HeH56i5fNv8ZxFDWa0A.s['19']++;return res.status(200).end();});}});}else{__cov_075HeH56i5fNv8ZxFDWa0A.b['1'][1]++;__cov_075HeH56i5fNv8ZxFDWa0A.s['20']++;return next(new Error('stripeEvent.data.object.customer is undefined'));}};__cov_075HeH56i5fNv8ZxFDWa0A.s['21']++;module.exports=function(req,res,next){__cov_075HeH56i5fNv8ZxFDWa0A.f['5']++;__cov_075HeH56i5fNv8ZxFDWa0A.s['22']++;if((__cov_075HeH56i5fNv8ZxFDWa0A.b['7'][0]++,req.stripeEvent)&&(__cov_075HeH56i5fNv8ZxFDWa0A.b['7'][1]++,req.stripeEvent.type)&&(__cov_075HeH56i5fNv8ZxFDWa0A.b['7'][2]++,knownEvents[req.stripeEvent.type])){__cov_075HeH56i5fNv8ZxFDWa0A.b['6'][0]++;__cov_075HeH56i5fNv8ZxFDWa0A.s['23']++;knownEvents[req.stripeEvent.type](req,res,next);}else{__cov_075HeH56i5fNv8ZxFDWa0A.b['6'][1]++;__cov_075HeH56i5fNv8ZxFDWa0A.s['24']++;return next(new Error('Stripe Event not found'));}};
