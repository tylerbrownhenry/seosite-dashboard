"use strict";
var __cov_cjHqe1bUEZcnmXuUZFxH9A = (Function('return this'))();
if (!__cov_cjHqe1bUEZcnmXuUZFxH9A.__coverage__) { __cov_cjHqe1bUEZcnmXuUZFxH9A.__coverage__ = {}; }
__cov_cjHqe1bUEZcnmXuUZFxH9A = __cov_cjHqe1bUEZcnmXuUZFxH9A.__coverage__;
if (!(__cov_cjHqe1bUEZcnmXuUZFxH9A['app/controllers/pages/user/admin/delete-controller.js'])) {
   __cov_cjHqe1bUEZcnmXuUZFxH9A['app/controllers/pages/user/admin/delete-controller.js'] = {"path":"app/controllers/pages/user/admin/delete-controller.js","s":{"1":0,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":1,"15":0,"16":0,"17":0,"18":0,"19":1,"20":0,"21":0,"22":0,"23":0,"24":0,"25":1,"26":0,"27":0,"28":0,"29":0,"30":1,"31":0,"32":0,"33":0,"34":0,"35":0,"36":1,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},"fnMap":{"1":{"name":"_deleteAccount","line":34,"loc":{"start":{"line":34,"column":0},"end":{"line":34,"column":58}}},"2":{"name":"(anonymous_2)","line":39,"loc":{"start":{"line":39,"column":4},"end":{"line":39,"column":32}}},"3":{"name":"(anonymous_3)","line":45,"loc":{"start":{"line":45,"column":56},"end":{"line":45,"column":70}}},"4":{"name":"deleteAccount","line":61,"loc":{"start":{"line":61,"column":0},"end":{"line":61,"column":39}}},"5":{"name":"(anonymous_5)","line":62,"loc":{"start":{"line":62,"column":54},"end":{"line":62,"column":65}}},"6":{"name":"getAll","line":77,"loc":{"start":{"line":77,"column":0},"end":{"line":77,"column":32}}},"7":{"name":"(anonymous_7)","line":80,"loc":{"start":{"line":80,"column":5},"end":{"line":80,"column":24}}},"8":{"name":"deleteAll","line":95,"loc":{"start":{"line":95,"column":0},"end":{"line":95,"column":33}}},"9":{"name":"(anonymous_9)","line":96,"loc":{"start":{"line":96,"column":34},"end":{"line":96,"column":53}}},"10":{"name":"deleteEverything","line":110,"loc":{"start":{"line":110,"column":0},"end":{"line":110,"column":35}}},"11":{"name":"(anonymous_11)","line":112,"loc":{"start":{"line":112,"column":14},"end":{"line":112,"column":29}}},"12":{"name":"(anonymous_12)","line":113,"loc":{"start":{"line":113,"column":22},"end":{"line":113,"column":36}}},"13":{"name":"deleteAllUserData","line":126,"loc":{"start":{"line":126,"column":0},"end":{"line":126,"column":49}}},"14":{"name":"(anonymous_14)","line":130,"loc":{"start":{"line":130,"column":5},"end":{"line":130,"column":19}}},"15":{"name":"(anonymous_15)","line":136,"loc":{"start":{"line":136,"column":7},"end":{"line":136,"column":21}}},"16":{"name":"(anonymous_16)","line":142,"loc":{"start":{"line":142,"column":9},"end":{"line":142,"column":23}}},"17":{"name":"(anonymous_17)","line":146,"loc":{"start":{"line":146,"column":35},"end":{"line":146,"column":49}}},"18":{"name":"(anonymous_18)","line":150,"loc":{"start":{"line":150,"column":37},"end":{"line":150,"column":48}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":25,"column":85}},"2":{"start":{"line":34,"column":0},"end":{"line":53,"column":1}},"3":{"start":{"line":35,"column":2},"end":{"line":35,"column":65}},"4":{"start":{"line":36,"column":2},"end":{"line":52,"column":7}},"5":{"start":{"line":40,"column":6},"end":{"line":42,"column":7}},"6":{"start":{"line":41,"column":8},"end":{"line":41,"column":56}},"7":{"start":{"line":43,"column":6},"end":{"line":43,"column":103}},"8":{"start":{"line":44,"column":6},"end":{"line":51,"column":11}},"9":{"start":{"line":45,"column":8},"end":{"line":51,"column":11}},"10":{"start":{"line":46,"column":10},"end":{"line":46,"column":51}},"11":{"start":{"line":47,"column":10},"end":{"line":49,"column":11}},"12":{"start":{"line":48,"column":12},"end":{"line":48,"column":31}},"13":{"start":{"line":50,"column":10},"end":{"line":50,"column":58}},"14":{"start":{"line":61,"column":0},"end":{"line":69,"column":1}},"15":{"start":{"line":62,"column":2},"end":{"line":68,"column":5}},"16":{"start":{"line":63,"column":4},"end":{"line":63,"column":17}},"17":{"start":{"line":64,"column":4},"end":{"line":66,"column":7}},"18":{"start":{"line":67,"column":4},"end":{"line":67,"column":39}},"19":{"start":{"line":77,"column":0},"end":{"line":88,"column":1}},"20":{"start":{"line":78,"column":2},"end":{"line":87,"column":4}},"21":{"start":{"line":81,"column":4},"end":{"line":86,"column":5}},"22":{"start":{"line":82,"column":6},"end":{"line":82,"column":43}},"23":{"start":{"line":83,"column":6},"end":{"line":83,"column":14}},"24":{"start":{"line":85,"column":6},"end":{"line":85,"column":47}},"25":{"start":{"line":95,"column":0},"end":{"line":103,"column":1}},"26":{"start":{"line":96,"column":2},"end":{"line":102,"column":4}},"27":{"start":{"line":97,"column":4},"end":{"line":101,"column":5}},"28":{"start":{"line":98,"column":6},"end":{"line":98,"column":42}},"29":{"start":{"line":100,"column":6},"end":{"line":100,"column":48}},"30":{"start":{"line":110,"column":0},"end":{"line":118,"column":1}},"31":{"start":{"line":111,"column":2},"end":{"line":111,"column":85}},"32":{"start":{"line":112,"column":2},"end":{"line":116,"column":5}},"33":{"start":{"line":113,"column":4},"end":{"line":115,"column":7}},"34":{"start":{"line":114,"column":6},"end":{"line":114,"column":27}},"35":{"start":{"line":117,"column":2},"end":{"line":117,"column":7}},"36":{"start":{"line":126,"column":0},"end":{"line":157,"column":1}},"37":{"start":{"line":127,"column":2},"end":{"line":127,"column":29}},"38":{"start":{"line":128,"column":2},"end":{"line":156,"column":5}},"39":{"start":{"line":131,"column":4},"end":{"line":133,"column":5}},"40":{"start":{"line":132,"column":6},"end":{"line":132,"column":25}},"41":{"start":{"line":134,"column":4},"end":{"line":155,"column":7}},"42":{"start":{"line":137,"column":6},"end":{"line":139,"column":7}},"43":{"start":{"line":138,"column":8},"end":{"line":138,"column":27}},"44":{"start":{"line":140,"column":6},"end":{"line":154,"column":9}},"45":{"start":{"line":143,"column":8},"end":{"line":145,"column":9}},"46":{"start":{"line":144,"column":10},"end":{"line":144,"column":29}},"47":{"start":{"line":146,"column":8},"end":{"line":153,"column":11}},"48":{"start":{"line":147,"column":10},"end":{"line":149,"column":11}},"49":{"start":{"line":148,"column":12},"end":{"line":148,"column":31}},"50":{"start":{"line":150,"column":10},"end":{"line":152,"column":12}},"51":{"start":{"line":151,"column":12},"end":{"line":151,"column":21}},"52":{"start":{"line":159,"column":0},"end":{"line":159,"column":53}},"53":{"start":{"line":160,"column":0},"end":{"line":160,"column":51}},"54":{"start":{"line":161,"column":0},"end":{"line":161,"column":37}},"55":{"start":{"line":162,"column":0},"end":{"line":162,"column":31}},"56":{"start":{"line":163,"column":0},"end":{"line":163,"column":45}},"57":{"start":{"line":164,"column":0},"end":{"line":164,"column":47}}},"branchMap":{"1":{"line":40,"type":"if","locations":[{"start":{"line":40,"column":6},"end":{"line":40,"column":6}},{"start":{"line":40,"column":6},"end":{"line":40,"column":6}}]},"2":{"line":40,"type":"binary-expr","locations":[{"start":{"line":40,"column":10},"end":{"line":40,"column":13}},{"start":{"line":40,"column":17},"end":{"line":40,"column":52}}]},"3":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":6},"end":{"line":44,"column":6}},{"start":{"line":44,"column":6},"end":{"line":44,"column":6}}]},"4":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":10},"end":{"line":47,"column":10}},{"start":{"line":47,"column":10},"end":{"line":47,"column":10}}]},"5":{"line":81,"type":"if","locations":[{"start":{"line":81,"column":4},"end":{"line":81,"column":4}},{"start":{"line":81,"column":4},"end":{"line":81,"column":4}}]},"6":{"line":97,"type":"if","locations":[{"start":{"line":97,"column":4},"end":{"line":97,"column":4}},{"start":{"line":97,"column":4},"end":{"line":97,"column":4}}]},"7":{"line":131,"type":"if","locations":[{"start":{"line":131,"column":4},"end":{"line":131,"column":4}},{"start":{"line":131,"column":4},"end":{"line":131,"column":4}}]},"8":{"line":137,"type":"if","locations":[{"start":{"line":137,"column":6},"end":{"line":137,"column":6}},{"start":{"line":137,"column":6},"end":{"line":137,"column":6}}]},"9":{"line":143,"type":"if","locations":[{"start":{"line":143,"column":8},"end":{"line":143,"column":8}},{"start":{"line":143,"column":8},"end":{"line":143,"column":8}}]},"10":{"line":147,"type":"if","locations":[{"start":{"line":147,"column":10},"end":{"line":147,"column":10}},{"start":{"line":147,"column":10},"end":{"line":147,"column":10}}]}}};
}
__cov_cjHqe1bUEZcnmXuUZFxH9A = __cov_cjHqe1bUEZcnmXuUZFxH9A['app/controllers/pages/user/admin/delete-controller.js'];
__cov_cjHqe1bUEZcnmXuUZFxH9A.s['1']++;var stripeActions=require('../../../../models/plugins/actions-stripe'),utils=require('../../../../utils'),_console=require('../../../../debug/console'),q=require('Q'),messages=require('../../../../messages/messages'),secrets=require('../../../../config/secrets').stripeOptions,_=require('underscore'),Stripe=require('stripe'),Subscription=require('../../../../models/subscription'),Activity=require('../../../../models/activity'),Email=require('../../../../models/email'),Scan=require('../../../../models/scan'),Update=require('../../../../models/update'),PasswordResetToken=require('../../../../models/passwordResetToken'),Link=require('../../../../models/link'),Alert=require('../../../../models/alert'),Capture=require('../../../../models/capture'),Request=require('../../../../models/request'),User=require('../../../../models/user'),stripeActions=require('../../../../models/plugins/actions-stripe'),sh=require('shorthash'),createToken=require('../../../../middleware/passport-create-token'),subscriptionController=require('../../../subscriptions/subscription-controller');function _deleteAccount(customerId,user,failed,passed){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['1']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['3']++;_console.log('_deleteAccount',user,'customerId',customerId);__cov_cjHqe1bUEZcnmXuUZFxH9A.s['4']++;utils.findBy(Subscription,{customerId:customerId},function(err,subscription){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['2']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['5']++;if((__cov_cjHqe1bUEZcnmXuUZFxH9A.b['2'][0]++,err)||(__cov_cjHqe1bUEZcnmXuUZFxH9A.b['2'][1]++,typeof subscription==='undefined')){__cov_cjHqe1bUEZcnmXuUZFxH9A.b['1'][0]++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['6']++;exports.deleteAllUserData(user,failed,passed);}else{__cov_cjHqe1bUEZcnmXuUZFxH9A.b['1'][1]++;}__cov_cjHqe1bUEZcnmXuUZFxH9A.s['7']++;_console.log('_deleteAccount:err',err,'subscription:',subscription,'customerId',customerId);__cov_cjHqe1bUEZcnmXuUZFxH9A.s['8']++;if(subscription){__cov_cjHqe1bUEZcnmXuUZFxH9A.b['3'][0]++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['9']++;subscriptionController.cancelStripe(customerId,function(err){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['3']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['10']++;_console.log('_deleteAccount err:',err);__cov_cjHqe1bUEZcnmXuUZFxH9A.s['11']++;if(err!==null){__cov_cjHqe1bUEZcnmXuUZFxH9A.b['4'][0]++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['12']++;return failed(err);}else{__cov_cjHqe1bUEZcnmXuUZFxH9A.b['4'][1]++;}__cov_cjHqe1bUEZcnmXuUZFxH9A.s['13']++;exports.deleteAllUserData(user,failed,passed);});}else{__cov_cjHqe1bUEZcnmXuUZFxH9A.b['3'][1]++;}});};function deleteAccount(req,res,next){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['4']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['15']++;_deleteAccount(req.user.customerId,req.user,next,function(){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['5']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['16']++;req.logout();__cov_cjHqe1bUEZcnmXuUZFxH9A.s['17']++;req.flash('info',{msg:'Your account has been deleted.'});__cov_cjHqe1bUEZcnmXuUZFxH9A.s['18']++;res.redirect(req.redirect.success);});}function getAll(uid,model,cb){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['6']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['20']++;utils.getAllItems(model,{uid:uid},function(err,res){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['7']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['21']++;if(err===null){__cov_cjHqe1bUEZcnmXuUZFxH9A.b['5'][0]++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['22']++;_console.log('Got All...',res,err);__cov_cjHqe1bUEZcnmXuUZFxH9A.s['23']++;cb(res);}else{__cov_cjHqe1bUEZcnmXuUZFxH9A.b['5'][1]++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['24']++;_console.log('Err Getting...',err,res);}});}function deleteAll(model,items){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['8']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['26']++;utils.deleteItems(model,items,function(err,res){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['9']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['27']++;if(err===null){__cov_cjHqe1bUEZcnmXuUZFxH9A.b['6'][0]++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['28']++;_console.log('Deleted All...',res);}else{__cov_cjHqe1bUEZcnmXuUZFxH9A.b['6'][1]++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['29']++;_console.log('Err Deleting...',err,res);}});}function deleteEverything(uid,cb){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['10']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['31']++;var arr=[Email,Alert,Scan,Request,Link,Update,PasswordResetToken,Capture];__cov_cjHqe1bUEZcnmXuUZFxH9A.s['32']++;_.each(arr,function(item){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['11']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['33']++;getAll(uid,item,function(res){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['12']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['34']++;deleteAll(item,res);});});__cov_cjHqe1bUEZcnmXuUZFxH9A.s['35']++;cb();}function deleteAllUserData(user,failed,passed){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['13']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['37']++;_console.log('user',user);__cov_cjHqe1bUEZcnmXuUZFxH9A.s['38']++;utils.deleteItem(Subscription,{customerId:user.customerId},function(err){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['14']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['39']++;if(err){__cov_cjHqe1bUEZcnmXuUZFxH9A.b['7'][0]++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['40']++;return failed(err);}else{__cov_cjHqe1bUEZcnmXuUZFxH9A.b['7'][1]++;}__cov_cjHqe1bUEZcnmXuUZFxH9A.s['41']++;utils.deleteItem(Activity,{oid:user.oid},function(err){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['15']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['42']++;if(err){__cov_cjHqe1bUEZcnmXuUZFxH9A.b['8'][0]++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['43']++;return failed(err);}else{__cov_cjHqe1bUEZcnmXuUZFxH9A.b['8'][1]++;}__cov_cjHqe1bUEZcnmXuUZFxH9A.s['44']++;utils.deleteItem(Email,{email:user.email},function(err){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['16']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['45']++;if(err){__cov_cjHqe1bUEZcnmXuUZFxH9A.b['9'][0]++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['46']++;return failed(err);}else{__cov_cjHqe1bUEZcnmXuUZFxH9A.b['9'][1]++;}__cov_cjHqe1bUEZcnmXuUZFxH9A.s['47']++;utils.deleteUser(user.uid,function(err){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['17']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['48']++;if(err){__cov_cjHqe1bUEZcnmXuUZFxH9A.b['10'][0]++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['49']++;return failed(err);}else{__cov_cjHqe1bUEZcnmXuUZFxH9A.b['10'][1]++;}__cov_cjHqe1bUEZcnmXuUZFxH9A.s['50']++;deleteEverything(user.uid,function(){__cov_cjHqe1bUEZcnmXuUZFxH9A.f['18']++;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['51']++;passed();});});});});});}__cov_cjHqe1bUEZcnmXuUZFxH9A.s['52']++;module.exports.deleteAllUserData=deleteAllUserData;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['53']++;module.exports.deleteEverything=deleteEverything;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['54']++;module.exports.deleteAll=deleteAll;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['55']++;module.exports.getAll=getAll;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['56']++;module.exports.deleteAccount=deleteAccount;__cov_cjHqe1bUEZcnmXuUZFxH9A.s['57']++;module.exports._deleteAccount=_deleteAccount;
