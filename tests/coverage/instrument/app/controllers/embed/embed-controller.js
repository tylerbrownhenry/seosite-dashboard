"use strict";
var __cov_wczUV3yQlK5SZLq$RDNniw = (Function('return this'))();
if (!__cov_wczUV3yQlK5SZLq$RDNniw.__coverage__) { __cov_wczUV3yQlK5SZLq$RDNniw.__coverage__ = {}; }
__cov_wczUV3yQlK5SZLq$RDNniw = __cov_wczUV3yQlK5SZLq$RDNniw.__coverage__;
if (!(__cov_wczUV3yQlK5SZLq$RDNniw['app/controllers/embed/embed-controller.js'])) {
   __cov_wczUV3yQlK5SZLq$RDNniw['app/controllers/embed/embed-controller.js'] = {"path":"app/controllers/embed/embed-controller.js","s":{"1":0,"2":0,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":1,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":1,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":1,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0},"fnMap":{"1":{"name":"validateHash","line":23,"loc":{"start":{"line":23,"column":0},"end":{"line":23,"column":33}}},"2":{"name":"(anonymous_2)","line":29,"loc":{"start":{"line":29,"column":8},"end":{"line":29,"column":29}}},"3":{"name":"(anonymous_3)","line":61,"loc":{"start":{"line":61,"column":22},"end":{"line":61,"column":42}}},"4":{"name":"(anonymous_4)","line":74,"loc":{"start":{"line":74,"column":17},"end":{"line":74,"column":52}}},"5":{"name":"validateEmbedEmail","line":86,"loc":{"start":{"line":86,"column":0},"end":{"line":86,"column":44}}},"6":{"name":"(anonymous_6)","line":89,"loc":{"start":{"line":89,"column":8},"end":{"line":89,"column":30}}},"7":{"name":"(anonymous_7)","line":98,"loc":{"start":{"line":98,"column":13},"end":{"line":98,"column":34}}},"8":{"name":"performScan","line":118,"loc":{"start":{"line":118,"column":0},"end":{"line":118,"column":32}}},"9":{"name":"(anonymous_9)","line":129,"loc":{"start":{"line":129,"column":86},"end":{"line":129,"column":105}}},"10":{"name":"(anonymous_10)","line":152,"loc":{"start":{"line":152,"column":35},"end":{"line":152,"column":55}}},"11":{"name":"(anonymous_11)","line":155,"loc":{"start":{"line":155,"column":21},"end":{"line":155,"column":38}}},"12":{"name":"_checkPlanPermission","line":205,"loc":{"start":{"line":205,"column":0},"end":{"line":205,"column":60}}},"13":{"name":"(anonymous_13)","line":207,"loc":{"start":{"line":207,"column":80},"end":{"line":207,"column":96}}},"14":{"name":"(anonymous_14)","line":212,"loc":{"start":{"line":212,"column":90},"end":{"line":212,"column":106}}},"15":{"name":"(anonymous_15)","line":213,"loc":{"start":{"line":213,"column":69},"end":{"line":213,"column":100}}},"16":{"name":"(anonymous_16)","line":229,"loc":{"start":{"line":229,"column":20},"end":{"line":229,"column":40}}},"17":{"name":"(anonymous_17)","line":232,"loc":{"start":{"line":232,"column":52},"end":{"line":232,"column":72}}},"18":{"name":"(anonymous_18)","line":237,"loc":{"start":{"line":237,"column":13},"end":{"line":237,"column":38}}},"19":{"name":"(anonymous_19)","line":242,"loc":{"start":{"line":242,"column":23},"end":{"line":242,"column":52}}},"20":{"name":"(anonymous_20)","line":246,"loc":{"start":{"line":246,"column":45},"end":{"line":246,"column":66}}},"21":{"name":"(anonymous_21)","line":266,"loc":{"start":{"line":266,"column":14},"end":{"line":266,"column":29}}},"22":{"name":"(anonymous_22)","line":280,"loc":{"start":{"line":280,"column":21},"end":{"line":280,"column":41}}},"23":{"name":"(anonymous_23)","line":289,"loc":{"start":{"line":289,"column":27},"end":{"line":289,"column":44}}},"24":{"name":"(anonymous_24)","line":295,"loc":{"start":{"line":295,"column":31},"end":{"line":295,"column":52}}},"25":{"name":"(anonymous_25)","line":301,"loc":{"start":{"line":301,"column":24},"end":{"line":301,"column":39}}}},"statementMap":{"1":{"start":{"line":2,"column":0},"end":{"line":2,"column":27}},"2":{"start":{"line":3,"column":0},"end":{"line":15,"column":57}},"3":{"start":{"line":23,"column":0},"end":{"line":38,"column":1}},"4":{"start":{"line":24,"column":5},"end":{"line":24,"column":29}},"5":{"start":{"line":25,"column":5},"end":{"line":25,"column":43}},"6":{"start":{"line":26,"column":5},"end":{"line":36,"column":8}},"7":{"start":{"line":30,"column":7},"end":{"line":30,"column":42}},"8":{"start":{"line":31,"column":10},"end":{"line":35,"column":11}},"9":{"start":{"line":32,"column":15},"end":{"line":32,"column":37}},"10":{"start":{"line":34,"column":15},"end":{"line":34,"column":32}},"11":{"start":{"line":37,"column":5},"end":{"line":37,"column":28}},"12":{"start":{"line":54,"column":0},"end":{"line":54,"column":37}},"13":{"start":{"line":61,"column":0},"end":{"line":67,"column":2}},"14":{"start":{"line":62,"column":5},"end":{"line":66,"column":8}},"15":{"start":{"line":74,"column":0},"end":{"line":78,"column":2}},"16":{"start":{"line":75,"column":5},"end":{"line":77,"column":8}},"17":{"start":{"line":86,"column":0},"end":{"line":116,"column":1}},"18":{"start":{"line":87,"column":5},"end":{"line":115,"column":8}},"19":{"start":{"line":90,"column":10},"end":{"line":92,"column":11}},"20":{"start":{"line":91,"column":15},"end":{"line":91,"column":62}},"21":{"start":{"line":93,"column":10},"end":{"line":95,"column":11}},"22":{"start":{"line":94,"column":15},"end":{"line":94,"column":80}},"23":{"start":{"line":96,"column":10},"end":{"line":114,"column":13}},"24":{"start":{"line":99,"column":15},"end":{"line":101,"column":16}},"25":{"start":{"line":100,"column":20},"end":{"line":100,"column":67}},"26":{"start":{"line":102,"column":15},"end":{"line":104,"column":16}},"27":{"start":{"line":103,"column":20},"end":{"line":103,"column":68}},"28":{"start":{"line":105,"column":15},"end":{"line":113,"column":16}},"29":{"start":{"line":106,"column":20},"end":{"line":110,"column":21}},"30":{"start":{"line":107,"column":25},"end":{"line":107,"column":99}},"31":{"start":{"line":109,"column":25},"end":{"line":109,"column":92}},"32":{"start":{"line":112,"column":20},"end":{"line":112,"column":100}},"33":{"start":{"line":118,"column":0},"end":{"line":203,"column":1}},"34":{"start":{"line":119,"column":5},"end":{"line":202,"column":6}},"35":{"start":{"line":127,"column":10},"end":{"line":127,"column":38}},"36":{"start":{"line":128,"column":10},"end":{"line":128,"column":26}},"37":{"start":{"line":129,"column":10},"end":{"line":200,"column":13}},"38":{"start":{"line":130,"column":12},"end":{"line":137,"column":13}},"39":{"start":{"line":131,"column":14},"end":{"line":134,"column":17}},"40":{"start":{"line":139,"column":12},"end":{"line":149,"column":14}},"41":{"start":{"line":151,"column":12},"end":{"line":151,"column":52}},"42":{"start":{"line":152,"column":12},"end":{"line":158,"column":15}},"43":{"start":{"line":153,"column":16},"end":{"line":153,"column":76}},"44":{"start":{"line":156,"column":16},"end":{"line":156,"column":71}},"45":{"start":{"line":199,"column":15},"end":{"line":199,"column":45}},"46":{"start":{"line":205,"column":0},"end":{"line":227,"column":1}},"47":{"start":{"line":206,"column":2},"end":{"line":206,"column":27}},"48":{"start":{"line":207,"column":5},"end":{"line":226,"column":8}},"49":{"start":{"line":208,"column":10},"end":{"line":208,"column":60}},"50":{"start":{"line":209,"column":10},"end":{"line":225,"column":11}},"51":{"start":{"line":210,"column":15},"end":{"line":210,"column":42}},"52":{"start":{"line":212,"column":15},"end":{"line":224,"column":17}},"53":{"start":{"line":213,"column":20},"end":{"line":223,"column":22}},"54":{"start":{"line":214,"column":25},"end":{"line":214,"column":80}},"55":{"start":{"line":215,"column":25},"end":{"line":222,"column":26}},"56":{"start":{"line":216,"column":30},"end":{"line":219,"column":33}},"57":{"start":{"line":221,"column":30},"end":{"line":221,"column":53}},"58":{"start":{"line":229,"column":0},"end":{"line":273,"column":2}},"59":{"start":{"line":230,"column":5},"end":{"line":230,"column":39}},"60":{"start":{"line":232,"column":5},"end":{"line":272,"column":7}},"61":{"start":{"line":234,"column":10},"end":{"line":234,"column":44}},"62":{"start":{"line":235,"column":10},"end":{"line":265,"column":13}},"63":{"start":{"line":238,"column":15},"end":{"line":264,"column":16}},"64":{"start":{"line":240,"column":20},"end":{"line":261,"column":23}},"65":{"start":{"line":243,"column":25},"end":{"line":260,"column":26}},"66":{"start":{"line":244,"column":30},"end":{"line":244,"column":72}},"67":{"start":{"line":246,"column":30},"end":{"line":257,"column":59}},"68":{"start":{"line":247,"column":35},"end":{"line":247,"column":67}},"69":{"start":{"line":248,"column":35},"end":{"line":256,"column":36}},"70":{"start":{"line":249,"column":40},"end":{"line":249,"column":75}},"71":{"start":{"line":250,"column":40},"end":{"line":253,"column":43}},"72":{"start":{"line":255,"column":40},"end":{"line":255,"column":91}},"73":{"start":{"line":259,"column":30},"end":{"line":259,"column":72}},"74":{"start":{"line":263,"column":20},"end":{"line":263,"column":58}},"75":{"start":{"line":267,"column":10},"end":{"line":267,"column":50}},"76":{"start":{"line":268,"column":10},"end":{"line":271,"column":13}},"77":{"start":{"line":280,"column":0},"end":{"line":316,"column":2}},"78":{"start":{"line":281,"column":5},"end":{"line":281,"column":65}},"79":{"start":{"line":285,"column":5},"end":{"line":285,"column":18}},"80":{"start":{"line":286,"column":5},"end":{"line":286,"column":26}},"81":{"start":{"line":287,"column":5},"end":{"line":287,"column":29}},"82":{"start":{"line":289,"column":5},"end":{"line":291,"column":8}},"83":{"start":{"line":290,"column":10},"end":{"line":290,"column":46}},"84":{"start":{"line":293,"column":5},"end":{"line":293,"column":38}},"85":{"start":{"line":295,"column":5},"end":{"line":315,"column":8}},"86":{"start":{"line":296,"column":10},"end":{"line":300,"column":13}},"87":{"start":{"line":301,"column":10},"end":{"line":314,"column":13}},"88":{"start":{"line":302,"column":15},"end":{"line":302,"column":39}},"89":{"start":{"line":303,"column":15},"end":{"line":313,"column":16}},"90":{"start":{"line":304,"column":20},"end":{"line":308,"column":23}},"91":{"start":{"line":310,"column":20},"end":{"line":312,"column":23}}},"branchMap":{"1":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":10},"end":{"line":31,"column":10}},{"start":{"line":31,"column":10},"end":{"line":31,"column":10}}]},"2":{"line":31,"type":"binary-expr","locations":[{"start":{"line":31,"column":14},"end":{"line":31,"column":18}},{"start":{"line":31,"column":22},"end":{"line":31,"column":34}}]},"3":{"line":90,"type":"if","locations":[{"start":{"line":90,"column":10},"end":{"line":90,"column":10}},{"start":{"line":90,"column":10},"end":{"line":90,"column":10}}]},"4":{"line":93,"type":"if","locations":[{"start":{"line":93,"column":10},"end":{"line":93,"column":10}},{"start":{"line":93,"column":10},"end":{"line":93,"column":10}}]},"5":{"line":99,"type":"if","locations":[{"start":{"line":99,"column":15},"end":{"line":99,"column":15}},{"start":{"line":99,"column":15},"end":{"line":99,"column":15}}]},"6":{"line":102,"type":"if","locations":[{"start":{"line":102,"column":15},"end":{"line":102,"column":15}},{"start":{"line":102,"column":15},"end":{"line":102,"column":15}}]},"7":{"line":105,"type":"if","locations":[{"start":{"line":105,"column":15},"end":{"line":105,"column":15}},{"start":{"line":105,"column":15},"end":{"line":105,"column":15}}]},"8":{"line":106,"type":"if","locations":[{"start":{"line":106,"column":20},"end":{"line":106,"column":20}},{"start":{"line":106,"column":20},"end":{"line":106,"column":20}}]},"9":{"line":119,"type":"if","locations":[{"start":{"line":119,"column":5},"end":{"line":119,"column":5}},{"start":{"line":119,"column":5},"end":{"line":119,"column":5}}]},"10":{"line":130,"type":"if","locations":[{"start":{"line":130,"column":12},"end":{"line":130,"column":12}},{"start":{"line":130,"column":12},"end":{"line":130,"column":12}}]},"11":{"line":209,"type":"if","locations":[{"start":{"line":209,"column":10},"end":{"line":209,"column":10}},{"start":{"line":209,"column":10},"end":{"line":209,"column":10}}]},"12":{"line":215,"type":"if","locations":[{"start":{"line":215,"column":25},"end":{"line":215,"column":25}},{"start":{"line":215,"column":25},"end":{"line":215,"column":25}}]},"13":{"line":238,"type":"if","locations":[{"start":{"line":238,"column":15},"end":{"line":238,"column":15}},{"start":{"line":238,"column":15},"end":{"line":238,"column":15}}]},"14":{"line":243,"type":"if","locations":[{"start":{"line":243,"column":25},"end":{"line":243,"column":25}},{"start":{"line":243,"column":25},"end":{"line":243,"column":25}}]},"15":{"line":248,"type":"if","locations":[{"start":{"line":248,"column":35},"end":{"line":248,"column":35}},{"start":{"line":248,"column":35},"end":{"line":248,"column":35}}]},"16":{"line":303,"type":"if","locations":[{"start":{"line":303,"column":15},"end":{"line":303,"column":15}},{"start":{"line":303,"column":15},"end":{"line":303,"column":15}}]}}};
}
__cov_wczUV3yQlK5SZLq$RDNniw = __cov_wczUV3yQlK5SZLq$RDNniw['app/controllers/embed/embed-controller.js'];
__cov_wczUV3yQlK5SZLq$RDNniw.s['1']++;require('dotenv').config();__cov_wczUV3yQlK5SZLq$RDNniw.s['2']++;var utils=require('../../utils'),q=require('q'),_=require('underscore'),filename='embed/embed-controller.js',EmbedHash=require('../../models/embedHash'),pageScan=require('../../api-requests/requests/pageScan'),PageScanOptions=require('../../api-requests/requests/pageScanOptions'),subscriptionController=require('../subscriptions/subscription-controller'),userController=require('../pages/user/users-controller'),Email=require('../../models/email'),User=require('../../models/user'),Activity=require('../../models/activity'),Subscription=require('../../models/subscription');function validateHash(hash,oid){__cov_wczUV3yQlK5SZLq$RDNniw.f['1']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['4']++;var promise=q.defer();__cov_wczUV3yQlK5SZLq$RDNniw.s['5']++;console.log('hash',hash,'oid',oid);__cov_wczUV3yQlK5SZLq$RDNniw.s['6']++;utils.findBy(EmbedHash,{_id:hash,oid:oid},function(err,data){__cov_wczUV3yQlK5SZLq$RDNniw.f['2']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['7']++;console.log('err',err,'data',data);__cov_wczUV3yQlK5SZLq$RDNniw.s['8']++;if((__cov_wczUV3yQlK5SZLq$RDNniw.b['2'][0]++,data)&&(__cov_wczUV3yQlK5SZLq$RDNniw.b['2'][1]++,err===null)){__cov_wczUV3yQlK5SZLq$RDNniw.b['1'][0]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['9']++;promise.resolve(data);}else{__cov_wczUV3yQlK5SZLq$RDNniw.b['1'][1]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['10']++;promise.reject();}});__cov_wczUV3yQlK5SZLq$RDNniw.s['11']++;return promise.promise;}__cov_wczUV3yQlK5SZLq$RDNniw.s['12']++;exports._validateHash=validateHash;__cov_wczUV3yQlK5SZLq$RDNniw.s['13']++;exports.invalidHash=function(req,res){__cov_wczUV3yQlK5SZLq$RDNniw.f['3']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['14']++;res.render(req.render,{message:'Forbidden',embed:false,error:'Invalid Hash Provided'});};__cov_wczUV3yQlK5SZLq$RDNniw.s['15']++;exports.render=function(req,res,input,apiKey){__cov_wczUV3yQlK5SZLq$RDNniw.f['4']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['16']++;res.render('embed/monitor-tile',{something:'goeshere'});};function validateEmbedEmail(email,oid,cb){__cov_wczUV3yQlK5SZLq$RDNniw.f['5']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['18']++;utils.findBy(Email,{email:String(email).toLowerCase()},function(err,email){__cov_wczUV3yQlK5SZLq$RDNniw.f['6']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['19']++;if(err){__cov_wczUV3yQlK5SZLq$RDNniw.b['3'][0]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['20']++;return cb(false,'white:label:database:error');}else{__cov_wczUV3yQlK5SZLq$RDNniw.b['3'][1]++;}__cov_wczUV3yQlK5SZLq$RDNniw.s['21']++;if(!email){__cov_wczUV3yQlK5SZLq$RDNniw.b['4'][0]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['22']++;return cb(true,'white:label:api:internal:email:does:not:exist');}else{__cov_wczUV3yQlK5SZLq$RDNniw.b['4'][1]++;}__cov_wczUV3yQlK5SZLq$RDNniw.s['23']++;utils.findBy(User,{uid:email.uid},function(err,user){__cov_wczUV3yQlK5SZLq$RDNniw.f['7']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['24']++;if(err){__cov_wczUV3yQlK5SZLq$RDNniw.b['5'][0]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['25']++;return cb(false,'white:label:database:error');}else{__cov_wczUV3yQlK5SZLq$RDNniw.b['5'][1]++;}__cov_wczUV3yQlK5SZLq$RDNniw.s['26']++;if(!user){__cov_wczUV3yQlK5SZLq$RDNniw.b['6'][0]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['27']++;return cb(false,'white:label:data:sync:error');}else{__cov_wczUV3yQlK5SZLq$RDNniw.b['6'][1]++;}__cov_wczUV3yQlK5SZLq$RDNniw.s['28']++;if(user.oid===oid){__cov_wczUV3yQlK5SZLq$RDNniw.b['7'][0]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['29']++;if(user.role==='lead'){__cov_wczUV3yQlK5SZLq$RDNniw.b['8'][0]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['30']++;return cb(false,'white:label:api:response:email:is:lead:already:scanned');}else{__cov_wczUV3yQlK5SZLq$RDNniw.b['8'][1]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['31']++;return cb(true,'white:label:api:internal:email:is:account',user);}}else{__cov_wczUV3yQlK5SZLq$RDNniw.b['7'][1]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['32']++;return cb(false,'white:label:api:response:email:belongs:diff:org:white:label');}});});}function performScan(req,user){__cov_wczUV3yQlK5SZLq$RDNniw.f['8']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['34']++;if(typeof user!=='undefined'){__cov_wczUV3yQlK5SZLq$RDNniw.b['9'][0]++;}else{__cov_wczUV3yQlK5SZLq$RDNniw.b['9'][1]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['35']++;req.body.password='unset';__cov_wczUV3yQlK5SZLq$RDNniw.s['36']++;req.lead=true;__cov_wczUV3yQlK5SZLq$RDNniw.s['37']++;userController.findOrCreateUser(req,req.body.email,'unset',req.body.oid,function(err,res){__cov_wczUV3yQlK5SZLq$RDNniw.f['9']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['38']++;if(err!==null){__cov_wczUV3yQlK5SZLq$RDNniw.b['10'][0]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['39']++;res.json({error:true,err:err});}else{__cov_wczUV3yQlK5SZLq$RDNniw.b['10'][1]++;}__cov_wczUV3yQlK5SZLq$RDNniw.s['40']++;var data={'uid':res.uid,'oid':res.oid,'url':req.body.url,'source':req.body.source,'scanGroup':'default','type':req.body.type,'temp_id':req.body.url,'requestType':'embed:scan','token':req.body.hash};__cov_wczUV3yQlK5SZLq$RDNniw.s['41']++;var options=new PageScanOptions(data);__cov_wczUV3yQlK5SZLq$RDNniw.s['42']++;pageScan(options).then(function(response){__cov_wczUV3yQlK5SZLq$RDNniw.f['10']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['43']++;console.log('requests.js queue/page --> success',response);}).catch(function(error){__cov_wczUV3yQlK5SZLq$RDNniw.f['11']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['44']++;console.log('requests.js queue/page --> error',error);});__cov_wczUV3yQlK5SZLq$RDNniw.s['45']++;console.log('RES WHAAAA',res);});}}function _checkPlanPermission(req,res,plan,subscription){__cov_wczUV3yQlK5SZLq$RDNniw.f['12']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['47']++;console.log('plan',plan);__cov_wczUV3yQlK5SZLq$RDNniw.s['48']++;subscriptionController.checkPlanPermissions(plan,'can:white:label',true,function(resp){__cov_wczUV3yQlK5SZLq$RDNniw.f['13']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['49']++;console.log('can you do this?',resp,typeof resp);__cov_wczUV3yQlK5SZLq$RDNniw.s['50']++;if(resp===false){__cov_wczUV3yQlK5SZLq$RDNniw.b['11'][0]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['51']++;console.log('not allowed');}else{__cov_wczUV3yQlK5SZLq$RDNniw.b['11'][1]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['52']++;subscriptionController.checkPlanPermissions(plan,'can:white:label',true,function(resp){__cov_wczUV3yQlK5SZLq$RDNniw.f['14']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['53']++;validateEmbedEmail(req.body.email,req.body.oid,function(resp,message,user){__cov_wczUV3yQlK5SZLq$RDNniw.f['15']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['54']++;console.log('validateEmbedEmail',resp,message,user);__cov_wczUV3yQlK5SZLq$RDNniw.s['55']++;if(resp!==true){__cov_wczUV3yQlK5SZLq$RDNniw.b['12'][0]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['56']++;res.json({error:true,err:message});}else{__cov_wczUV3yQlK5SZLq$RDNniw.b['12'][1]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['57']++;performScan(req,user);}});});}});}__cov_wczUV3yQlK5SZLq$RDNniw.s['58']++;exports.embedScan=function(req,res){__cov_wczUV3yQlK5SZLq$RDNniw.f['16']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['59']++;console.log('req.body',req.body);__cov_wczUV3yQlK5SZLq$RDNniw.s['60']++;validateHash(req.body.hash,req.body.oid).then(function(response){__cov_wczUV3yQlK5SZLq$RDNniw.f['17']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['61']++;console.log('response',response);__cov_wczUV3yQlK5SZLq$RDNniw.s['62']++;utils.findBy(Activity,{oid:req.body.oid},function(err,activity){__cov_wczUV3yQlK5SZLq$RDNniw.f['18']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['63']++;if(err===null){__cov_wczUV3yQlK5SZLq$RDNniw.b['13'][0]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['64']++;utils.findBy(Subscription,{customerId:activity.customerId},function(err,subscription){__cov_wczUV3yQlK5SZLq$RDNniw.f['19']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['65']++;if(err===null){__cov_wczUV3yQlK5SZLq$RDNniw.b['14'][0]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['66']++;console.log('subscription',subscription);__cov_wczUV3yQlK5SZLq$RDNniw.s['67']++;utils.getPlans(function(err,plan){__cov_wczUV3yQlK5SZLq$RDNniw.f['20']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['68']++;console.log('GOT PLANS!',plan);__cov_wczUV3yQlK5SZLq$RDNniw.s['69']++;if(err){__cov_wczUV3yQlK5SZLq$RDNniw.b['15'][0]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['70']++;console.log('error getting plans');__cov_wczUV3yQlK5SZLq$RDNniw.s['71']++;res.json({error:true,err:err});}else{__cov_wczUV3yQlK5SZLq$RDNniw.b['15'][1]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['72']++;_checkPlanPermission(req,res,plan,subscription);}},false,subscription.plan);}else{__cov_wczUV3yQlK5SZLq$RDNniw.b['14'][1]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['73']++;console.log('error finding subscription');}});}else{__cov_wczUV3yQlK5SZLq$RDNniw.b['13'][1]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['74']++;console.log('error finding activity');}});}).catch(function(err){__cov_wczUV3yQlK5SZLq$RDNniw.f['21']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['75']++;console.log('err validating hash',err);__cov_wczUV3yQlK5SZLq$RDNniw.s['76']++;res.json({error:true,_id:'yes'});});};__cov_wczUV3yQlK5SZLq$RDNniw.s['77']++;exports.createHash=function(req,res){__cov_wczUV3yQlK5SZLq$RDNniw.f['22']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['78']++;console.log('req',req.user.identity,'req.body',req.body);__cov_wczUV3yQlK5SZLq$RDNniw.s['79']++;var str='';__cov_wczUV3yQlK5SZLq$RDNniw.s['80']++;var input=req.body;__cov_wczUV3yQlK5SZLq$RDNniw.s['81']++;input.date=new Date();__cov_wczUV3yQlK5SZLq$RDNniw.s['82']++;_.each(_.keys(input),function(param){__cov_wczUV3yQlK5SZLq$RDNniw.f['23']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['83']++;str+=JSON.stringify(input[param]);});__cov_wczUV3yQlK5SZLq$RDNniw.s['84']++;var salt=req.user.identity.oid;__cov_wczUV3yQlK5SZLq$RDNniw.s['85']++;utils.encrypt(str+salt,function(err,hash){__cov_wczUV3yQlK5SZLq$RDNniw.f['24']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['86']++;var thisHash=new EmbedHash({_id:hash,name:input.name,oid:req.user.identity.oid});__cov_wczUV3yQlK5SZLq$RDNniw.s['87']++;thisHash.save(function(err){__cov_wczUV3yQlK5SZLq$RDNniw.f['25']++;__cov_wczUV3yQlK5SZLq$RDNniw.s['88']++;console.log('err',err);__cov_wczUV3yQlK5SZLq$RDNniw.s['89']++;if(err===null){__cov_wczUV3yQlK5SZLq$RDNniw.b['16'][0]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['90']++;res.json({success:true,_id:hash,oid:req.user.identity.oid});}else{__cov_wczUV3yQlK5SZLq$RDNniw.b['16'][1]++;__cov_wczUV3yQlK5SZLq$RDNniw.s['91']++;res.json({error:true});}});});};
